<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PRF-22 Builder - Digital Twin Prototype</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }
        
        header h1 { font-size: 2.5em; margin-bottom: 10px; }
        header p { font-size: 1.2em; opacity: 0.95; }
        
        .progress-bar {
            background: #f0f0f0;
            height: 8px;
            position: relative;
        }
        
        .progress-fill {
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            height: 100%;
            width: 0%;
            transition: width 0.5s ease;
        }
        
        .content {
            padding: 50px;
        }
        
        .page {
            display: none;
        }
        
        .page.active {
            display: block;
            animation: fadeIn 0.5s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .page h2 {
            color: #667eea;
            font-size: 2em;
            margin-bottom: 10px;
        }
        
        .page .subtitle {
            color: #666;
            font-size: 1.1em;
            margin-bottom: 30px;
        }
        
        .scenario-box {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }
        
        .scenario-box h3 {
            color: #333;
            font-size: 1.2em;
            margin-bottom: 15px;
        }
        
        .scenario-box .scenario-text {
            color: #555;
            font-style: italic;
            margin-bottom: 15px;
            line-height: 1.8;
        }
        
        .scenario-box .question {
            color: #333;
            font-weight: 500;
            margin-bottom: 15px;
        }
        
        .likert-scale {
            display: flex;
            justify-content: space-between;
            margin: 20px 0;
            gap: 10px;
        }
        
        .likert-option {
            flex: 1;
            text-align: center;
        }
        
        .likert-option input[type="radio"] {
            display: none;
        }
        
        .likert-option label {
            display: block;
            padding: 15px 10px;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9em;
        }
        
        .likert-option input[type="radio"]:checked + label {
            background: #667eea;
            color: white;
            border-color: #667eea;
            transform: scale(1.05);
        }
        
        .likert-option label:hover {
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
        }
        
        .multiple-choice {
            margin: 20px 0;
        }
        
        .mc-option {
            background: white;
            border: 2px solid #e0e0e0;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .mc-option:hover {
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
        }
        
        .mc-option input[type="radio"] {
            margin-right: 10px;
        }
        
        .mc-option.selected {
            background: #f0f4ff;
            border-color: #667eea;
            border-width: 3px;
        }
        
        .buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 40px;
            padding-top: 30px;
            border-top: 2px solid #f0f0f0;
        }
        
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.1em;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }
        
        button:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }
        
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        button.secondary {
            background: #6c757d;
        }
        
        button.secondary:hover {
            background: #5a6268;
        }
        
        .profile-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .profile-card {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 25px;
            border-radius: 8px;
        }
        
        .profile-card h3 {
            color: #667eea;
            margin-bottom: 15px;
        }
        
        .profile-card .value-high {
            color: #27ae60;
            font-weight: bold;
        }
        
        .profile-card .value-low {
            color: #e74c3c;
            font-weight: bold;
        }
        
        .profile-card .value-medium {
            color: #f39c12;
            font-weight: bold;
        }
        
        .philosopher-match {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 12px;
            margin: 30px 0;
            text-align: center;
        }
        
        .philosopher-match h3 {
            font-size: 1.8em;
            margin-bottom: 15px;
        }
        
        .authenticity-check {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 12px;
            padding: 30px;
            margin: 30px 0;
        }
        
        .authenticity-check h3 {
            color: #856404;
            margin-bottom: 20px;
            font-size: 1.5em;
        }
        
        .authenticity-question {
            margin: 20px 0;
            padding: 20px;
            background: white;
            border-radius: 8px;
        }
        
        .authenticity-question p {
            font-size: 1.1em;
            margin-bottom: 15px;
            color: #333;
        }
        
        .alert {
            background: #d6eaf8;
            border-left: 4px solid #3498db;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }
        
        .alert strong {
            color: #1f618d;
            display: block;
            margin-bottom: 10px;
            font-size: 1.2em;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üß† Build Your Digital Twin</h1>
            <p>PRF-22: Computational Model of Your Ethical Framework</p>
        </header>
        
        <div class="progress-bar">
            <div class="progress-fill" id="progressBar"></div>
        </div>
        
        <div class="content">
            <!-- Page 0: Welcome -->
            <div class="page active" id="page0">
                <h2>Welcome to PRF-22 Builder</h2>
                <p class="subtitle">Create a computational model of YOUR ethical framework</p>
                
                <div class="alert">
                    <strong>What This Tool Does:</strong>
                    <p>‚Ä¢ Answer 22 scenario-based questions honestly (20-25 minutes)</p>
                    <p>‚Ä¢ We build a computational model of YOUR ethical framework (your "digital twin")</p>
                    <p>‚Ä¢ See what YOUR values logically imply</p>
                    <p>‚Ä¢ Test how well the model captures who you really are</p>
                    <p>‚Ä¢ No right answers - just honest reflection on how YOU think</p>
                </div>
                
                <div class="scenario-box">
                    <h3>This is NOT about finding the "correct" ethics</h3>
                    <p>This is about understanding YOUR ethics deeply enough to:</p>
                    <ul style="margin-left: 20px; margin-top: 10px;">
                        <li>Identify what you actually value (not what you think you should value)</li>
                        <li>Spot inconsistencies between stated beliefs and actual choices</li>
                        <li>Build self-knowledge through computational reflection</li>
                        <li>Test: Does this model feel like "me"?</li>
                    </ul>
                </div>
                
                <div class="buttons">
                    <div></div>
                    <button onclick="nextPage()">Begin Building My Digital Twin ‚Üí</button>
                </div>
            </div>
            
            <!-- Pages 1-22: Questions (will be generated by JavaScript) -->
            
            <!-- Results Page -->
            <div class="page" id="results">
                <h2>Your Ethical Framework Profile</h2>
                <p class="subtitle">Here's what your responses reveal about how you see the world</p>
                
                <div class="philosopher-match" id="philosopherMatch">
                    <h3>üéØ Your Philosophical Profile</h3>
                    <p id="matchText">Loading...</p>
                </div>
                
                <div class="profile-grid" id="profileGrid">
                    <!-- Populated by JavaScript -->
                </div>
                
                <!-- PHENOMENOLOGICAL AUTHENTICITY CHECK -->
                <div class="authenticity-check">
                    <h3>üîç Authenticity Check: Does This Feel Like "You"?</h3>
                    <p>Now that you see your profile, we want to know: <strong>How well does this computational model capture who you really are?</strong></p>
                    
                    <div class="authenticity-question">
                        <p><strong>1. Overall Match:</strong> How well does this profile match your understanding of yourself?</p>
                        <div class="likert-scale">
                            <div class="likert-option">
                                <input type="radio" name="auth_overall" value="1" id="auth_o1">
                                <label for="auth_o1">Not at all<br>(1)</label>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="auth_overall" value="2" id="auth_o2">
                                <label for="auth_o2">Slightly<br>(2)</label>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="auth_overall" value="3" id="auth_o3">
                                <label for="auth_o3">Moderately<br>(3)</label>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="auth_overall" value="4" id="auth_o4">
                                <label for="auth_o4">Very well<br>(4)</label>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="auth_overall" value="5" id="auth_o5">
                                <label for="auth_o5">Perfectly<br>(5)</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="authenticity-question">
                        <p><strong>2. Surprises:</strong> Did anything in this profile surprise you about yourself?</p>
                        <textarea style="width: 100%; height: 100px; padding: 10px; border-radius: 6px; border: 2px solid #ddd;" 
                                  id="auth_surprises" 
                                  placeholder="Example: 'I thought I valued loyalty more, but my low score makes sense given how I actually make decisions...'"></textarea>
                    </div>
                    
                    <div class="authenticity-question">
                        <p><strong>3. Mismatches:</strong> What (if anything) does this profile get wrong about you?</p>
                        <textarea style="width: 100%; height: 100px; padding: 10px; border-radius: 6px; border: 2px solid #ddd;" 
                                  id="auth_mismatches"
                                  placeholder="Example: 'The low authority score is right for work, but wrong for family contexts...'"></textarea>
                    </div>
                    
                    <div class="authenticity-question">
                        <p><strong>4. Recognizability:</strong> If a close friend read this profile (without knowing it's yours), would they recognize it as YOU?</p>
                        <div class="likert-scale">
                            <div class="likert-option">
                                <input type="radio" name="auth_friend" value="1" id="auth_f1">
                                <label for="auth_f1">Definitely not<br>(1)</label>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="auth_friend" value="2" id="auth_f2">
                                <label for="auth_f2">Probably not<br>(2)</label>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="auth_friend" value="3" id="auth_f3">
                                <label for="auth_f3">Maybe<br>(3)</label>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="auth_friend" value="4" id="auth_f4">
                                <label for="auth_f4">Probably yes<br>(4)</label>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="auth_friend" value="5" id="auth_f5">
                                <label for="auth_f5">Definitely yes<br>(5)</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="authenticity-question">
                        <p><strong>5. Usefulness:</strong> Does seeing this profile help you understand yourself better?</p>
                        <div class="likert-scale">
                            <div class="likert-option">
                                <input type="radio" name="auth_useful" value="1" id="auth_u1">
                                <label for="auth_u1">Not at all<br>(1)</label>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="auth_useful" value="2" id="auth_u2">
                                <label for="auth_u2">A little<br>(2)</label>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="auth_useful" value="3" id="auth_u3">
                                <label for="auth_u3">Moderately<br>(3)</label>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="auth_useful" value="4" id="auth_u4">
                                <label for="auth_u4">Quite a bit<br>(4)</label>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="auth_useful" value="5" id="auth_u5">
                                <label for="auth_u5">Extremely<br>(5)</label>
                            </div>
                        </div>
                    </div>
                    
                    <button onclick="submitAuthenticity()" style="width: 100%; margin-top: 20px;">
                        Submit Authenticity Feedback
                    </button>
                </div>
                
                <div class="alert" style="margin-top: 30px;">
                    <strong>What happens next?</strong>
                    <p>In a full study, we would:</p>
                    <p>‚Ä¢ Test whether this profile predicts YOUR choices in new dilemmas</p>
                    <p>‚Ä¢ Compare your predicted choices to your actual choices</p>
                    <p>‚Ä¢ Refine the model based on mismatches</p>
                    <p>‚Ä¢ Build a true "digital twin" of your ethical reasoning</p>
                </div>
                
                <div class="buttons">
                    <button class="secondary" onclick="location.reload()">Start Over</button>
                    <button onclick="downloadProfile()">Download My Profile</button>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // PRF-22 Questions (from validated instrument)
        const questions = [
            // Item 1: Care/Harm
            {
                scenario: "At a party, someone makes a cutting remark. You see the target of the remark become visibly upset and withdraw.",
                question: "It is important to interrupt what's happening to comfort the person who is hurt.",
                construct: "care"
            },
            // Item 2: Fairness
            {
                scenario: "You learn your employer accidentally overpaid you this month, and no one else noticed.",
                question: "You should notify the employer and return the extra money so things are fair.",
                construct: "fairness"
            },
            // Item 3: Loyalty
            {
                scenario: "A close friend is being publicly criticized online in a way you think is unfair. Defending them might also draw negative attention to you.",
                question: "You should defend your friend publicly to show solidarity.",
                construct: "loyalty"
            },
            // Item 4: Authority
            {
                scenario: "In a volunteer organization, a respected leader asks everyone to follow a formal procedure that feels unnecessary but maintains order.",
                question: "People should follow the leader's procedure out of respect for the role and hierarchy.",
                construct: "authority"
            },
            // Item 5: Purity
            {
                scenario: "A friend decorates their apartment in a way you find disgusting (e.g., graphic 'gross-out' art), but they genuinely love it and feel it expresses them.",
                question: "When something feels disgusting, that reaction is an important moral signal about what should or should not be allowed in shared spaces.",
                construct: "purity"
            },
            // Item 6: Idealism
            {
                scenario: "In a science demonstration, performing it offers great learning but carries a tiny risk of giving someone a mild electric shock.",
                question: "We should never do this demonstration if there is any risk of harm, even a very small risk.",
                construct: "idealism"
            },
            // Item 7: Idealism
            {
                scenario: "A company can save money by taking a shortcut that might harm some customers, but the harm is unlikely and the savings are significant.",
                question: "It is wrong to take this shortcut, even if the risk is small and the benefits are large.",
                construct: "idealism"
            },
            // Item 8: Relativism
            {
                scenario: "Two different cultures have completely opposite views about what is morally right in a specific situation.",
                question: "What is ethical varies from one culture or situation to another.",
                construct: "relativism"
            },
            // Item 9: Universalism
            {
                scenario: "You can donate to a cause that helps many people you'll never meet, or to a local cause that helps fewer people but in your community.",
                question: "It is more important to help people based on need, regardless of whether they're near or far.",
                construct: "universalism"
            },
            // Item 10: Benevolence
            {
                scenario: "A coworker is struggling with their workload and you could help them, but it would mean less time for your own projects.",
                question: "It is important to help those close to you even at personal cost.",
                construct: "benevolence"
            },
            // Item 11: Conformity
            {
                scenario: "In a group meeting, everyone seems to agree on a direction you privately think is wrong.",
                question: "It is better to go along with the group to avoid causing conflict.",
                construct: "conformity"
            },
            // Item 12: Tradition
            {
                scenario: "Your family has always done something a certain way, but you think a new approach would be better.",
                question: "It is important to respect and maintain traditional ways of doing things.",
                construct: "tradition"
            },
            // Item 13: Self-Direction
            {
                scenario: "You can choose between a stable path others recommend or a riskier path that aligns with your personal vision.",
                question: "It is more important to follow your own judgment than to follow others' advice.",
                construct: "self_direction"
            },
            // Item 14: DIT - Conventional (reverse scored)
            {
                scenario: "A person's spouse is dying. A drug would save them, but costs $2,000 and they only have $1,000. The pharmacist refuses to lower the price or accept delayed payment.",
                question: "It is morally wrong to steal the medicine, even if it would save the spouse's life.",
                construct: "dit_conventional",
                reversed: true
            },
            // Item 15: DIT - Fairness (reverse scored)
            {
                scenario: "A company can hire the most qualified candidate, but some customers and coworkers hold prejudiced views and might react badly. Management considers hiring a less qualified person to avoid conflict.",
                question: "It is acceptable to sacrifice fairness (not hiring the best candidate) in order to keep social peace.",
                construct: "dit_conventional",
                reversed: true
            },
            // Item 16: DIT - Breaking rules
            {
                scenario: "A community believes a new policy is unjust. Peaceful protest is ignored; a nonviolent sit-in that breaks minor laws could force attention.",
                question: "Sometimes it is necessary to break rules or laws in order to protest injustice.",
                construct: "dit_principled"
            },
            // Item 17: Traditional vs Secular
            {
                scenario: "You are asked what qualities matter most to teach children.",
                question: "It is more important for children to learn obedience and respect for authority than to learn independence and critical thinking.",
                construct: "traditional",
                reversed: true
            },
            // Item 18: Religion in public
            {
                scenario: "A public decision (e.g., school policy, public health) could be justified by religious doctrine or by secular evidence-based reasoning.",
                question: "Religious beliefs should carry as much weight as scientific reasoning in public decisions.",
                construct: "secular"
            },
            // Item 19: Tolerance
            {
                scenario: "A close acquaintance is openly gay. Some people in your broader community disapprove.",
                question: "People should accept someone's open homosexuality even if they personally disagree.",
                construct: "tolerance"
            },
            // Item 20: ATCF - T-prime constraint
            {
                scenario: "A single parent works two jobs, is exhausted, and is barely making rent. Their boss asks them to work unpaid overtime to 'be a team player,' implying they may be fired if they refuse.",
                question: "This person should refuse the request, even if they might be fired.",
                construct: "atcf_constraint",
                reversed: true
            },
            // Item 21: ATCF - Depletion
            {
                scenario: "A student is severely sleep-deprived after multiple nights of studying and makes an impulsive unethical choice during an exam.",
                question: "They are just as morally responsible as they would be if they were well-rested.",
                construct: "atcf_depletion",
                reversed: true
            },
            // Item 22: ATCF - Institutional capture
            {
                scenario: "An engineer believes a design is unsafe and documents the concern. Management overrides the objection and ships the design anyway. An accident occurs.",
                question: "Who is most responsible?",
                construct: "atcf_system",
                multipleChoice: true,
                options: [
                    "Engineer (they could have quit)",
                    "Management (they had final decision authority)",
                    "Both equally",
                    "Primarily management (engineer also shares responsibility)",
                    "The system is responsible (the organizational structure/incentives produced the outcome)"
                ]
            }
        ];
        
        let currentPage = 0;
        let responses = {};
        let authResponses = {};
        
        // Generate question pages
        function generateQuestionPages() {
            const content = document.querySelector('.content');
            const resultsPage = document.getElementById('results');
            
            questions.forEach((q, index) => {
                const pageDiv = document.createElement('div');
                pageDiv.className = 'page';
                pageDiv.id = `page${index + 1}`;
                
                let questionHTML = `
                    <h2>Question ${index + 1} of 22</h2>
                    <p class="subtitle">${getConstructLabel(q.construct)}</p>
                    
                    <div class="scenario-box">
                        <h3>Scenario:</h3>
                        <p class="scenario-text">${q.scenario}</p>
                        <p class="question">"${q.question}"</p>
                `;
                
                if (q.multipleChoice) {
                    questionHTML += `<div class="multiple-choice">`;
                    q.options.forEach((opt, i) => {
                        questionHTML += `
                            <div class="mc-option" onclick="selectMC(this, ${index}, ${i})">
                                <input type="radio" name="q${index}" value="${i}" id="q${index}_${i}">
                                <label for="q${index}_${i}">${opt}</label>
                            </div>
                        `;
                    });
                    questionHTML += `</div>`;
                } else {
                    questionHTML += `
                        <div class="likert-scale">
                            <div class="likert-option">
                                <input type="radio" name="q${index}" value="1" id="q${index}_1">
                                <label for="q${index}_1">Strongly<br>Disagree<br>(1)</label>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="q${index}" value="2" id="q${index}_2">
                                <label for="q${index}_2">Disagree<br><br>(2)</label>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="q${index}" value="3" id="q${index}_3">
                                <label for="q${index}_3">Neither<br><br>(3)</label>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="q${index}" value="4" id="q${index}_4">
                                <label for="q${index}_4">Agree<br><br>(4)</label>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="q${index}" value="5" id="q${index}_5">
                                <label for="q${index}_5">Strongly<br>Agree<br>(5)</label>
                            </div>
                        </div>
                    `;
                }
                
                questionHTML += `
                    </div>
                    <div class="buttons">
                        <button class="secondary" onclick="prevPage()">‚Üê Back</button>
                        <button onclick="nextPage()" id="next${index}">Continue ‚Üí</button>
                    </div>
                `;
                
                pageDiv.innerHTML = questionHTML;
                content.insertBefore(pageDiv, resultsPage);
            });
        }
        
        function getConstructLabel(construct) {
            const labels = {
                'care': 'Care/Harm Foundation',
                'fairness': 'Fairness/Reciprocity Foundation',
                'loyalty': 'Loyalty/Ingroup Foundation',
                'authority': 'Authority/Respect Foundation',
                'purity': 'Purity/Sanctity Foundation',
                'idealism': 'Ethical Idealism',
                'relativism': 'Moral Relativism',
                'universalism': 'Universalism Value',
                'benevolence': 'Benevolence Value',
                'conformity': 'Conformity Value',
                'tradition': 'Tradition Value',
                'self_direction': 'Self-Direction Value',
                'dit_conventional': 'Conventional Moral Reasoning',
                'dit_principled': 'Principled Moral Reasoning',
                'traditional': 'Traditional Orientation',
                'secular': 'Secular Orientation',
                'tolerance': 'Tolerance/Self-Expression',
                'atcf_constraint': 'ATCF: Constraint Recognition',
                'atcf_depletion': 'ATCF: Depletion Sensitivity',
                'atcf_system': 'ATCF: System Responsibility'
            };
            return labels[construct] || construct;
        }
        
        function selectMC(element, qIndex, optIndex) {
            // Deselect all
            element.parentElement.querySelectorAll('.mc-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            // Select this one
            element.classList.add('selected');
            element.querySelector('input').checked = true;
            responses[qIndex] = optIndex;
        }
        
        function nextPage() {
            // Save current response
            if (currentPage > 0 && currentPage <= 22) {
                const qIndex = currentPage - 1;
                if (!questions[qIndex].multipleChoice) {
                    const selected = document.querySelector(`input[name="q${qIndex}"]:checked`);
                    if (selected) {
                        responses[qIndex] = parseInt(selected.value);
                    }
                }
            }
            
            document.getElementById(`page${currentPage}`).classList.remove('active');
            currentPage++;
            
            if (currentPage <= 22) {
                document.getElementById(`page${currentPage}`).classList.add('active');
                updateProgress();
            } else {
                showResults();
            }
        }
        
        function prevPage() {
            document.getElementById(`page${currentPage}`).classList.remove('active');
            currentPage--;
            document.getElementById(`page${currentPage}`).classList.add('active');
            updateProgress();
        }
        
        function updateProgress() {
            const progress = (currentPage / 23) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
        }
        
        function showResults() {
            document.getElementById('results').classList.add('active');
            document.getElementById('progressBar').style.width = '100%';
            generateProfile();
        }
        
        function generateProfile() {
            // Calculate PRF parameters
            const profile = calculatePRF(responses);
            
            // Display philosophical match
            const match = determineMatch(profile);
            document.getElementById('matchText').innerHTML = match;
            
            // Display profile cards
            displayProfile(profile);
        }
        
        function calculatePRF(responses) {
            // Simplified calculation (actual would use z-scores)
            const profile = {
                mfq: {
                    care: responses[0] || 3,
                    fairness: responses[1] || 3,
                    loyalty: responses[2] || 3,
                    authority: responses[3] || 3,
                    purity: responses[4] || 3
                },
                epq: {
                    idealism: ((responses[5] || 3) + (responses[6] || 3)) / 2,
                    relativism: responses[7] || 3
                },
                values: {
                    universalism: responses[8] || 3,
                    benevolence: responses[9] || 3,
                    conformity: responses[10] || 3,
                    tradition: responses[11] || 3,
                    self_direction: responses[12] || 3
                },
                reasoning: {
                    conventional: ((6 - (responses[13] || 3)) + (6 - (responses[14] || 3))) / 2,
                    principled: responses[15] || 3
                },
                culture: {
                    traditional: 6 - (responses[16] || 3),
                    secular: responses[17] || 3,
                    tolerance: responses[18] || 3
                },
                atcf: {
                    constraint_sensitivity: 6 - (responses[19] || 3),
                    depletion_sensitivity: 6 - (responses[20] || 3),
                    system_responsibility: responses[21] || 2
                }
            };
            
            // Calculate higher-order
            profile.mfq.individualizing = (profile.mfq.care + profile.mfq.fairness) / 2;
            profile.mfq.binding = (profile.mfq.loyalty + profile.mfq.authority + profile.mfq.purity) / 3;
            profile.values.self_transcendence = (profile.values.universalism + profile.values.benevolence) / 2;
            profile.values.conservation = (profile.values.conformity + profile.values.tradition) / 2;
            profile.atcf.overall = (profile.atcf.constraint_sensitivity + profile.atcf.depletion_sensitivity) / 2;
            
            return profile;
        }
        
        function determineMatch(profile) {
            const care = profile.mfq.care;
            const fairness = profile.mfq.fairness;
            const individualizing = profile.mfq.individualizing;
            const binding = profile.mfq.binding;
            const idealism = profile.epq.idealism;
            const atcf = profile.atcf.overall;
            
            if (individualizing > 4 && binding < 3 && atcf > 3.5) {
                return "Liberal Care Ethicist with ATCF Sensitivity<br><em>Close to: Nel Noddings (Care Ethics) + Coherence Ethics</em>";
            } else if (individualizing > 4 && binding < 3) {
                return "Liberal/Progressive Ethics<br><em>Close to: John Stuart Mill (Utilitarian) or Carol Gilligan (Care Ethics)</em>";
            } else if (binding > 4 && individualizing < 3) {
                return "Conservative/Traditional Ethics<br><em>Close to: Edmund Burke or Confucian Ethics</em>";
            } else if (individualizing > 3.5 && binding > 3.5) {
                return "Balanced Moral Foundations<br><em>Integrates both individualizing and binding concerns</em>";
            } else if (idealism > 4) {
                return "Moral Absolutist<br><em>Close to: Immanuel Kant (Deontology)</em>";
            } else if (atcf > 4) {
                return "Coherence Ethics Orientation<br><em>Recognizes thermodynamic constraints on moral agency</em>";
            } else {
                return "Hybrid Ethical Framework<br><em>Combines elements from multiple traditions</em>";
            }
        }
        
        function displayProfile(profile) {
            const grid = document.getElementById('profileGrid');
            
            const valueClass = (val) => {
                if (val >= 4) return 'value-high';
                if (val <= 2) return 'value-low';
                return 'value-medium';
            };
            
            grid.innerHTML = `
                <div class="profile-card">
                    <h3>Moral Foundations</h3>
                    <p>Care/Harm: <span class="${valueClass(profile.mfq.care)}">${profile.mfq.care.toFixed(1)}</span></p>
                    <p>Fairness: <span class="${valueClass(profile.mfq.fairness)}">${profile.mfq.fairness.toFixed(1)}</span></p>
                    <p>Loyalty: <span class="${valueClass(profile.mfq.loyalty)}">${profile.mfq.loyalty.toFixed(1)}</span></p>
                    <p>Authority: <span class="${valueClass(profile.mfq.authority)}">${profile.mfq.authority.toFixed(1)}</span></p>
                    <p>Purity: <span class="${valueClass(profile.mfq.purity)}">${profile.mfq.purity.toFixed(1)}</span></p>
                    <hr style="margin: 15px 0;">
                    <p><strong>Individualizing:</strong> <span class="${valueClass(profile.mfq.individualizing)}">${profile.mfq.individualizing.toFixed(1)}</span></p>
                    <p><strong>Binding:</strong> <span class="${valueClass(profile.mfq.binding)}">${profile.mfq.binding.toFixed(1)}</span></p>
                </div>
                
                <div class="profile-card">
                    <h3>Ethical Ideology</h3>
                    <p>Idealism: <span class="${valueClass(profile.epq.idealism)}">${profile.epq.idealism.toFixed(1)}</span></p>
                    <p>Relativism: <span class="${valueClass(profile.epq.relativism)}">${profile.epq.relativism.toFixed(1)}</span></p>
                    <p style="margin-top: 15px; font-size: 0.9em; color: #666;">
                        ${profile.epq.idealism > 3.5 && profile.epq.relativism < 2.5 ? "Absolutist: Universal principles, avoid harm" :
                          profile.epq.idealism > 3.5 && profile.epq.relativism > 3.5 ? "Situationist: Context matters, avoid harm" :
                          profile.epq.idealism < 2.5 && profile.epq.relativism < 2.5 ? "Exceptionist: Pragmatic, some rules" :
                          "Subjectivist: Personal judgment primary"}
                    </p>
                </div>
                
                <div class="profile-card">
                    <h3>Values Priority</h3>
                    <p>Universalism: <span class="${valueClass(profile.values.universalism)}">${profile.values.universalism.toFixed(1)}</span></p>
                    <p>Benevolence: <span class="${valueClass(profile.values.benevolence)}">${profile.values.benevolence.toFixed(1)}</span></p>
                    <p>Self-Direction: <span class="${valueClass(profile.values.self_direction)}">${profile.values.self_direction.toFixed(1)}</span></p>
                    <p>Conformity: <span class="${valueClass(profile.values.conformity)}">${profile.values.conformity.toFixed(1)}</span></p>
                    <p>Tradition: <span class="${valueClass(profile.values.tradition)}">${profile.values.tradition.toFixed(1)}</span></p>
                </div>
                
                <div class="profile-card">
                    <h3>Moral Reasoning</h3>
                    <p>Conventional: <span class="${valueClass(profile.reasoning.conventional)}">${profile.reasoning.conventional.toFixed(1)}</span></p>
                    <p>Principled: <span class="${valueClass(profile.reasoning.principled)}">${profile.reasoning.principled.toFixed(1)}</span></p>
                    <p style="margin-top: 15px; font-size: 0.9em; color: #666;">
                        ${profile.reasoning.principled > 3.5 ? "Postconventional: Universal principles over rules" :
                          profile.reasoning.conventional > 3.5 ? "Conventional: Rules and social order matter" :
                          "Mixed reasoning level"}
                    </p>
                </div>
                
                <div class="profile-card">
                    <h3>Cultural Values</h3>
                    <p>Tolerance: <span class="${valueClass(profile.culture.tolerance)}">${profile.culture.tolerance.toFixed(1)}</span></p>
                    <p>Secular vs Traditional: <span class="${valueClass(6 - profile.culture.traditional)}">${profile.culture.traditional < 3 ? "Secular" : "Traditional"}</span></p>
                </div>
                
                <div class="profile-card" style="border-left-color: #e74c3c;">
                    <h3>‚ö° ATCF Sensitivity</h3>
                    <p>Constraint Recognition: <span class="${valueClass(profile.atcf.constraint_sensitivity)}">${profile.atcf.constraint_sensitivity.toFixed(1)}</span></p>
                    <p>Depletion Awareness: <span class="${valueClass(profile.atcf.depletion_sensitivity)}">${profile.atcf.depletion_sensitivity.toFixed(1)}</span></p>
                    <p>System Attribution: <span class="${valueClass(profile.atcf.system_responsibility)}">${
                        profile.atcf.system_responsibility === 0 ? "Engineer" :
                        profile.atcf.system_responsibility === 1 ? "Management" :
                        profile.atcf.system_responsibility === 2 ? "Both equally" :
                        profile.atcf.system_responsibility === 3 ? "Primarily management" :
                        "System responsible"
                    }</span></p>
                    <hr style="margin: 15px 0;">
                    <p><strong>Overall ATCF:</strong> <span class="${valueClass(profile.atcf.overall)}">${profile.atcf.overall.toFixed(1)}</span></p>
                    <p style="margin-top: 10px; font-size: 0.9em; color: #666;">
                        ${profile.atcf.overall > 3.5 ? "HIGH: Recognizes constraints on moral agency" :
                          profile.atcf.overall < 2.5 ? "LOW: Holds people fully responsible regardless" :
                          "MODERATE: Contextually sensitive"}
                    </p>
                </div>
            `;
        }
        
        function submitAuthenticity() {
            authResponses.overall = document.querySelector('input[name="auth_overall"]:checked')?.value || null;
            authResponses.surprises = document.getElementById('auth_surprises').value;
            authResponses.mismatches = document.getElementById('auth_mismatches').value;
            authResponses.friend = document.querySelector('input[name="auth_friend"]:checked')?.value || null;
            authResponses.useful = document.querySelector('input[name="auth_useful"]:checked')?.value || null;
            
            // In real implementation, would save to database
            console.log('Authenticity Responses:', authResponses);
            console.log('PRF Responses:', responses);
            
            alert('Thank you! Your feedback helps us improve the digital twin model.\n\nIn a full study, this data would help us:\n‚Ä¢ Validate phenomenological authenticity\n‚Ä¢ Identify common mismatches\n‚Ä¢ Refine the model\n‚Ä¢ Build better digital twins');
        }
        
        function downloadProfile() {
            const profile = calculatePRF(responses);
            const text = `MY ETHICAL FRAMEWORK PROFILE
            
Generated: ${new Date().toLocaleDateString()}

MORAL FOUNDATIONS:
- Care/Harm: ${profile.mfq.care.toFixed(1)}
- Fairness: ${profile.mfq.fairness.toFixed(1)}
- Loyalty: ${profile.mfq.loyalty.toFixed(1)}
- Authority: ${profile.mfq.authority.toFixed(1)}
- Purity: ${profile.mfq.purity.toFixed(1)}
- Individualizing (Care+Fairness): ${profile.mfq.individualizing.toFixed(1)}
- Binding (Loyalty+Authority+Purity): ${profile.mfq.binding.toFixed(1)}

ETHICAL IDEOLOGY:
- Idealism: ${profile.epq.idealism.toFixed(1)}
- Relativism: ${profile.epq.relativism.toFixed(1)}

VALUES:
- Universalism: ${profile.values.universalism.toFixed(1)}
- Benevolence: ${profile.values.benevolence.toFixed(1)}
- Self-Direction: ${profile.values.self_direction.toFixed(1)}
- Conformity: ${profile.values.conformity.toFixed(1)}
- Tradition: ${profile.values.tradition.toFixed(1)}

MORAL REASONING:
- Conventional: ${profile.reasoning.conventional.toFixed(1)}
- Principled: ${profile.reasoning.principled.toFixed(1)}

ATCF SENSITIVITY:
- Constraint Recognition: ${profile.atcf.constraint_sensitivity.toFixed(1)}
- Depletion Awareness: ${profile.atcf.depletion_sensitivity.toFixed(1)}
- Overall ATCF: ${profile.atcf.overall.toFixed(1)}

PHILOSOPHICAL MATCH:
${document.getElementById('matchText').textContent}

AUTHENTICITY FEEDBACK:
- Overall Match: ${authResponses.overall || "Not provided"}/5
- Surprises: ${authResponses.surprises || "None noted"}
- Mismatches: ${authResponses.mismatches || "None noted"}
- Friend Would Recognize: ${authResponses.friend || "Not provided"}/5
- Usefulness: ${authResponses.useful || "Not provided"}/5
`;
            
            const blob = new Blob([text], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'my_ethical_framework_profile.txt';
            a.click();
        }
        
        // Initialize
        generateQuestionPages();
    </script>
</body>
</html>
